<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amal Yaumi Ramadhan - SDIT Adzkia 1 Padang</title>
  <script src="https://cdn.tailwindcss.com"></script>  
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;family=Poppins:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    .font-amiri {
      font-family: 'Amiri', serif;
    }
    .font-poppins {
      font-family: 'Poppins', sans-serif;
    }
    .pattern-islamic {
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.08'%3E%3Cpath d='M30 0l30 30-30 30L0 30z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }
    .checkbox-islamic:checked {
      background-color: #059669;
      border-color: #059669;
    }
    .checkbox-islamic:checked::after {
      content: 'âœ“';
      color: white;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .glow-green {
      box-shadow: 0 0 20px rgba(5, 150, 105, 0.3);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    .lantern {
      animation: swing 3s ease-in-out infinite;
    }
    @keyframes swing {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
 </head>
 <body class="h-full font-poppins">
  <div id="app-wrapper" class="h-full w-full overflow-auto bg-gradient-to-br from-emerald-900 via-emerald-800 to-teal-900 pattern-islamic">
   <!-- LOGIN SCREEN -->
   <section id="login-screen" class="h-full flex items-center justify-center px-4">
    <div class="w-full max-w-md">
     <!-- Logo & Header -->
     <div class="text-center mb-8">
      <div class="flex justify-center mb-4">
       <svg width="80" height="80" viewbox="0 0 80 80" class="text-yellow-400">
        <path d="M40 5C20 5 5 22 5 42s15 37 35 37c-15-8-25-24-25-42S25 13 40 5z" fill="currentColor" /> <circle cx="55" cy="25" r="3" fill="currentColor" /> <circle cx="65" cy="35" r="2" fill="currentColor" /> <circle cx="60" cy="45" r="2.5" fill="currentColor" />
       </svg>
      </div>
      <h1 class="font-amiri text-3xl font-bold text-white mb-2 drop-shadow-lg">ğŸ“¿ Amal Yaumi</h1>
      <p class="text-emerald-200">Ramadhan 1447 H</p>
     </div><!-- Login Card -->
     <div class="bg-white/95 backdrop-blur rounded-2xl shadow-2xl p-8 mb-6 animate-fade-in">
      <!-- User Login Form -->
      <form id="user-login-form" onsubmit="handleUserLogin(event)" class="space-y-4">
       <div>
        <label for="user-username" class="block text-emerald-800 font-medium mb-2">ğŸ‘¤ Username</label> <input type="text" id="user-username" required placeholder="Masukkan username" class="w-full px-4 py-3 rounded-lg border-2 border-emerald-200 focus:border-emerald-500 focus:outline-none transition-colors">
       </div>
       <div>
        <label for="user-password" class="block text-emerald-800 font-medium mb-2">ğŸ”’ Password</label> <input type="password" id="user-password" required placeholder="Masukkan password" class="w-full px-4 py-3 rounded-lg border-2 border-emerald-200 focus:border-emerald-500 focus:outline-none transition-colors">
       </div><button type="submit" class="w-full py-3 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white font-bold rounded-lg transition-all transform hover:scale-[1.02]"> ğŸ”“ Masuk sebagai Siswa </button>
      </form><!-- Error Message -->
      <div id="login-error" class="hidden mt-4 p-3 bg-red-100 border border-red-300 rounded-lg text-red-800 text-sm text-center animate-fade-in">
       âŒ username atau password salah. Silakan coba lagi.
      </div>
     </div><!-- Info Box -->
     
    </div>
   </section><!-- DASHBOARD SCREEN (Hidden until login) -->
   <section id="dashboard-screen" class="hidden h-full flex flex-col">
    <!-- Header -->
    <header class="relative py-8 px-4 text-center">
     <!-- Decorative Lanterns -->
     <div class="absolute top-0 left-8 lantern">
      <svg width="40" height="60" viewbox="0 0 40 60" fill="none">
       <path d="M20 0v10M15 10h10M10 15c0 20 0 35 10 40 10-5 10-20 10-40H10z" stroke="#fbbf24" stroke-width="2" fill="#fbbf24" fill-opacity="0.3" /> <circle cx="20" cy="30" r="5" fill="#fbbf24" />
      </svg>
     </div>
     <div class="absolute top-0 right-8 lantern" style="animation-delay: 0.5s;">
      <svg width="40" height="60" viewbox="0 0 40 60" fill="none">
       <path d="M20 0v10M15 10h10M10 15c0 20 0 35 10 40 10-5 10-20 10-40H10z" stroke="#fbbf24" stroke-width="2" fill="#fbbf24" fill-opacity="0.3" /> <circle cx="20" cy="30" r="5" fill="#fbbf24" />
      </svg>
     </div><!-- Crescent Moon -->
     <div class="flex justify-center mb-4">
      <svg width="80" height="80" viewbox="0 0 80 80" class="text-yellow-400">
       <path d="M40 5C20 5 5 22 5 42s15 37 35 37c-15-8-25-24-25-42S25 13 40 5z" fill="currentColor" /> <circle cx="55" cy="25" r="3" fill="currentColor" /> <circle cx="65" cy="35" r="2" fill="currentColor" /> <circle cx="60" cy="45" r="2.5" fill="currentColor" />
      </svg>
     </div>
     <h1 id="page-title" class="font-amiri text-4xl md:text-5xl font-bold text-white mb-2 drop-shadow-lg">ğŸ“¿ Amal Yaumi Ramadhan</h1>
     <p class="text-yellow-300 font-amiri text-2xl mb-1">Ù¡Ù¤Ù¤Ù§ Ù‡</p>
     <p id="school-name" class="text-emerald-200 text-lg">SDIT Adzkia 1 Padang</p>
     <p class="text-emerald-300 text-sm mt-2">18 Februari - 18 Maret 2026</p>
     <p id="user-info" class="text-emerald-100 text-sm mt-3">ğŸ‘¤ Logged in as: <span id="current-user" class="font-bold text-yellow-300"></span></p><button onclick="logout()" class="absolute top-6 right-6 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition-colors flex items-center gap-2"> ğŸšª Logout </button>
    </header><!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 pb-8 flex-1">
     <!-- Navigation Tabs -->
     <div class="flex justify-center gap-2 mb-6">
      <button id="tab-input" onclick="showTab('input')" class="px-6 py-2 rounded-full font-medium transition-all bg-yellow-400 text-emerald-900"> âœï¸ Input Amal </button> <button id="tab-riwayat" onclick="showTab('riwayat')" class="px-6 py-2 rounded-full font-medium transition-all bg-emerald-700 text-white hover:bg-emerald-600"> ğŸ“‹ Riwayat </button>
     </div><!-- Input Form Section -->
     <section id="section-input" class="animate-fade-in">
      <form id="amal-form" class="bg-white/95 backdrop-blur rounded-2xl shadow-xl p-6 glow-green">
       <!-- Student Info -->
       <div class="grid md:grid-cols-2 gap-4 mb-6">
        <div>
         <label for="nama_siswa" class="block text-emerald-800 font-medium mb-2">ğŸ‘¤ Nama Siswa</label> <input type="text" id="nama_siswa" required placeholder="Masukkan nama lengkap" class="w-full px-4 py-3 rounded-xl border-2 border-emerald-200 focus:border-emerald-500 focus:outline-none transition-colors bg-emerald-50">
        </div>
        <div>
         <label for="kelas" class="block text-emerald-800 font-medium mb-2">ğŸ« Kelas</label> <input type="text" id="kelas" required placeholder="Contoh: 1A" class="w-full px-4 py-3 rounded-xl border-2 border-emerald-200 focus:border-emerald-500 focus:outline-none transition-colors bg-emerald-50">
        </div>
       </div><!-- Date Selection -->
       <div class="mb-6">
        <label for="tanggal" class="block text-emerald-800 font-medium mb-2">ğŸ“… Tanggal</label> <input type="date" id="tanggal" required min="2026-02-18" max="2026-03-18" class="w-full px-4 py-3 rounded-xl border-2 border-emerald-200 focus:border-emerald-500 focus:outline-none transition-colors">
       </div><!-- Sholat Section -->
       <div class="mb-6 p-4 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl">
        <h3 class="text-emerald-800 font-bold text-lg mb-4 flex items-center gap-2">ğŸ•Œ Sholat</h3>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
         <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_subuh" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">ğŸŒ… Subuh (10 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_dzuhur" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">â˜€ï¸ Dzuhur (10 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_ashar" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">ğŸŒ¤ï¸ Ashar (10 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_maghrib" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">ğŸŒ… Maghrib (10 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_isya" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">ğŸŒ™ Isya (10 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_tarawih" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">ğŸŒŸ Tarawih (5 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_witir" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">âœ¨ Witir (5 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_dhuha" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">ğŸŒ Dhuha (5 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_tahajud" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">ğŸŒƒ Tahajud (5 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sholat_rawatib" class="w-5 h-5 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"> <span class="text-gray-700">â­ Rawatib (5 Poin)</span> </label>
        </div>
       </div><!-- Puasa -->
       <div class="mb-6 p-4 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl">
        <h3 class="text-amber-800 font-bold text-lg mb-4 flex items-center gap-2">ğŸŒ™ Puasa</h3>
        <div class="grid grid-cols-2 gap-3">
         <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="puasa" class="w-5 h-5 rounded border-amber-300 text-amber-600 focus:ring-amber-500"> <span class="text-gray-700">ğŸŒ™ Puasa Penuh (10 Poin)</span> </label>
        </div>
       </div><!-- Quran Section -->
       <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl">
        <h3 class="text-blue-800 font-bold text-lg mb-4 flex items-center gap-2">ğŸ“– Al-Quran</h3>
        <div class="grid grid-cols-2 gap-3">
         <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="tilawah_quran" class="w-5 h-5 rounded border-blue-300 text-blue-600 focus:ring-blue-500"> <span class="text-gray-700">ğŸ“– Tilawah Al-Quran (3 Poin)</span> </label>
        </div>
       </div><!-- Other Activities -->
       <div class="mb-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl">
        <h3 class="text-purple-800 font-bold text-lg mb-4 flex items-center gap-2">ğŸ’« Amalan Lainnya</h3>
        <div class="grid grid-cols-2 gap-3">
         <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="sedekah" class="w-5 h-5 rounded border-purple-300 text-purple-600 focus:ring-purple-500"> <span class="text-gray-700">ğŸ’ Sedekah / Infak (3 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="membantu_ortu" class="w-5 h-5 rounded border-purple-300 text-purple-600 focus:ring-purple-500"> <span class="text-gray-700">ğŸ  Membantu Ortu (3 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="dzikir_pagi" class="w-5 h-5 rounded border-purple-300 text-purple-600 focus:ring-purple-500"> <span class="text-gray-700">ğŸŒ„ Dzikir Pagi (3 Poin)</span> </label> <label class="flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition-shadow"> <input type="checkbox" id="dzikir_petang" class="w-5 h-5 rounded border-purple-300 text-purple-600 focus:ring-purple-500"> <span class="text-gray-700">ğŸŒ† Dzikir Petang (3 Poin)</span> </label>
        </div>
       </div><!-- Points Display -->
       <div class="mb-6 p-4 bg-gradient-to-r from-yellow-100 to-amber-100 rounded-xl border-2 border-yellow-300">
        <h3 class="text-yellow-800 font-bold text-lg mb-3">â­ Total Poin</h3>
        <div id="points-breakdown" class="text-sm text-yellow-800 space-y-1 mb-3">
         <p>Pilih amalan untuk melihat rincian poin...</p>
        </div>
        <div class="text-center p-3 bg-yellow-300 rounded-lg">
         <p class="text-yellow-900 font-bold text-sm">Total Poin Hari Ini</p>
         <p id="total-points" class="text-yellow-900 font-bold text-3xl">0</p>
        </div>
       </div><!-- Submit Button --> <button type="submit" id="submit-btn" class="w-full py-4 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2"> <span id="submit-text">ğŸ’¾ Simpan Amal Yaumi</span> <span id="submit-loading" class="hidden">
         <svg class="animate-spin h-5 w-5" viewbox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" /> <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
         </svg></span> </button>
      </form><!-- Success Message -->
      <div id="success-message" class="hidden mt-4 p-4 bg-green-100 border border-green-300 rounded-xl text-green-800 text-center animate-fade-in">
       âœ… Alhamdulillah! Amal yaumi berhasil disimpan.
      </div>
     </section><!-- Riwayat Section -->
     <section id="section-riwayat" class="hidden animate-fade-in">
      <div class="bg-white/95 backdrop-blur rounded-2xl shadow-xl p-6 glow-green">
       <h3 class="text-emerald-800 font-bold text-xl mb-4 flex items-center gap-2">ğŸ“‹ Riwayat Amal Yaumi</h3><!-- Record Count Warning -->
       <div id="limit-warning" class="hidden mb-4 p-3 bg-yellow-100 border border-yellow-300 rounded-xl text-yellow-800 text-sm">
        âš ï¸ Hampir mencapai batas penyimpanan (999 entri). Pertimbangkan untuk mengunduh data.
       </div><!-- Records List -->
       <div id="records-list" class="space-y-3 max-h-96 overflow-y-auto">
        <p class="text-gray-500 text-center py-8">Belum ada data amal yaumi.</p>
       </div>
      </div>
     </section>
    </main><!-- Footer -->
    <footer class="text-center py-6 text-emerald-200 text-sm">
     <p>ğŸŒ™ Ramadhan Mubarak 1447 H ğŸŒ™</p>
     <p class="mt-1 text-emerald-300/70">SDIT Adzkia 1 Padang</p>
     <p class="mt-2 text-emerald-400 text-xs">Aplikasi dibuat oleh: Asriadi, S.PdI</p>
    </footer>
   </section>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      school_name: 'SDIT Adzkia 1 Padang',
      page_title: 'Amal Yaumi Ramadhan',
      background_color: '#064e3b',
      surface_color: '#ffffff',
      text_color: '#065f46',
      primary_action: '#059669',
      secondary_action: '#fbbf24'
    };

    let config = { ...defaultConfig };
    let allRecords = [];
    let currentRecordCount = 0;
    let currentUser = null;

    // Demo users database with student IDs
    let allUsers = [
        {
          username: 'siswa1',
          password: '123',
          role: 'siswa',
          nama_siswa: 'Ahmad Fauzan',
          kelas: '1A',
          studentId: 1
        },
        {
          username: 'siswa2',
          password: '123',
          role: 'siswa',
          nama_siswa: 'Muhammad Rizki',
          kelas: '1A',
          studentId: 2
        },
        {
          username: 'admin',
          password: 'admin123',
          role: 'admin',
          nama_siswa: 'Administrator',
          kelas: '-',
          studentId: null
        }
      ];

    // Point system
    const pointSystem = {
      sholat_subuh: 10,
      sholat_dzuhur: 10,
      sholat_ashar: 10,
      sholat_maghrib: 10,
      sholat_isya: 10,
      sholat_tarawih: 5,
      sholat_witir: 5,
      sholat_dhuha: 5,
      sholat_tahajud: 5,
      sholat_rawatib: 5,
      puasa: 10,
      tilawah_quran: 3,
      sedekah: 3,
      membantu_ortu: 3,
      dzikir_pagi: 3,
      dzikir_petang: 3
    };

    

    function handleUserLogin(e) {
        e.preventDefault();

        const username = document.getElementById('user-username').value.trim();
        const password = document.getElementById('user-password').value.trim();

        // Cari user di database HTML
        const foundUser = allUsers.find(user =>
          user.username === username && user.password === password
        );

        if (foundUser) {
          // Gunakan function login yang sudah ada
          login(foundUser.username, foundUser.role, foundUser.studentId);
        } else {
          showLoginError();
        }
      }

    function showLoginError() {
      document.getElementById('login-error').classList.remove('hidden');
      setTimeout(() => document.getElementById('login-error').classList.add('hidden'), 3000);
    }

    function login(username, role, studentId) {
      currentUser = { username, role, studentId };
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('dashboard-screen').classList.remove('hidden');
      document.getElementById('current-user').textContent = username + (role === 'admin' ? ' (Admin)' : '');
      
      // Auto-fill form for siswa role
      if (role === 'siswa' && studentId) {
        document.getElementById('nama_siswa').value = `Siswa Ke-${studentId}`;
        document.getElementById('kelas').value = 'Kelas 1';
        document.getElementById('nama_siswa').readOnly = true;
        document.getElementById('kelas').readOnly = true;
      }
      
      // Clear login form
      document.getElementById('user-username').value = '';
      document.getElementById('user-password').value = '';
    }

    function logout() {
      currentUser = null;
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('dashboard-screen').classList.add('hidden');
      document.getElementById('section-input').classList.remove('hidden');
      document.getElementById('section-riwayat').classList.add('hidden');
    }

    // Tab switching for dashboard
    function showTab(tab) {
      const inputSection = document.getElementById('section-input');
      const riwayatSection = document.getElementById('section-riwayat');
      const tabInput = document.getElementById('tab-input');
      const tabRiwayat = document.getElementById('tab-riwayat');

      if (tab === 'input') {
        inputSection.classList.remove('hidden');
        riwayatSection.classList.add('hidden');
        tabInput.className = 'px-6 py-2 rounded-full font-medium transition-all bg-yellow-400 text-emerald-900';
        tabRiwayat.className = 'px-6 py-2 rounded-full font-medium transition-all bg-emerald-700 text-white hover:bg-emerald-600';
      } else {
        inputSection.classList.add('hidden');
        riwayatSection.classList.remove('hidden');
        tabInput.className = 'px-6 py-2 rounded-full font-medium transition-all bg-emerald-700 text-white hover:bg-emerald-600';
        tabRiwayat.className = 'px-6 py-2 rounded-full font-medium transition-all bg-yellow-400 text-emerald-900';
      }
    }

    // Calculate total points
    function calculatePoints() {
      let total = 0;
      const breakdown = [];

      Object.keys(pointSystem).forEach(key => {
        const element = document.getElementById(key);
        if (element && element.checked) {
          const points = pointSystem[key];
          total += points;
          const label = element.closest('label')?.textContent?.split('(')[0]?.trim() || key;
          breakdown.push(`${label}: ${points} Poin`);
        }
      });

      // Update display
      const breakdownEl = document.getElementById('points-breakdown');
      const totalEl = document.getElementById('total-points');

      if (breakdown.length === 0) {
        breakdownEl.innerHTML = '<p>Pilih amalan untuk melihat rincian poin...</p>';
      } else {
        breakdownEl.innerHTML = breakdown.map(b => `<p>âœ“ ${b}</p>`).join('');
      }

      totalEl.textContent = total;
    }

    // Add event listeners for checkbox changes
    function setupCheckboxListeners() {
      Object.keys(pointSystem).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
          element.addEventListener('change', calculatePoints);
        }
      });
    }

    // Form submission
    async function handleSubmit(e) {
      e.preventDefault();

      

      const submitBtn = document.getElementById('submit-btn');
      const submitText = document.getElementById('submit-text');
      const submitLoading = document.getElementById('submit-loading');

      // Show loading
      submitBtn.disabled = true;
      submitText.classList.add('hidden');
      submitLoading.classList.remove('hidden');

      // Calculate points
      let totalPoin = 0;
      const formData = {
        nama_siswa: document.getElementById('nama_siswa').value,
        kelas: document.getElementById('kelas').value,
        tanggal: document.getElementById('tanggal').value,
        sholat_subuh: document.getElementById('sholat_subuh').checked,
        sholat_dzuhur: document.getElementById('sholat_dzuhur').checked,
        sholat_ashar: document.getElementById('sholat_ashar').checked,
        sholat_maghrib: document.getElementById('sholat_maghrib').checked,
        sholat_isya: document.getElementById('sholat_isya').checked,
        sholat_tarawih: document.getElementById('sholat_tarawih').checked,
        sholat_witir: document.getElementById('sholat_witir').checked,
        sholat_dhuha: document.getElementById('sholat_dhuha').checked,
        sholat_tahajud: document.getElementById('sholat_tahajud').checked,
        sholat_rawatib: document.getElementById('sholat_rawatib').checked,
        puasa: document.getElementById('puasa').checked,
        tilawah_quran: document.getElementById('tilawah_quran').checked,
        sedekah: document.getElementById('sedekah').checked,
        membantu_ortu: document.getElementById('membantu_ortu').checked,
        dzikir_pagi: document.getElementById('dzikir_pagi').checked,
        dzikir_petang: document.getElementById('dzikir_petang').checked,
        created_at: new Date().toISOString()
      };

      // Calculate total points
      Object.keys(pointSystem).forEach(key => {
        if (formData[key] === true) {
          totalPoin += pointSystem[key];
        }
      });

      formData.total_poin = totalPoin;

      const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzzMnpBfTAmR3CaVhMsIi6tOfg5kCfK_lqGyDHpZ8kM2gwtVwyucJHHtji_dBER_e28/exec";

      try {
        await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify(formData),
          headers: {
            "Content-Type": "application/json"
          }
        });

        showMessage('âœ… Data berhasil dikirim. Cek Google Sheet.', 'success');
        resetForm();

      } catch (error) {
        showMessage('âŒ Tidak bisa terhubung ke server.', 'error');
      }

      // Hide loading
      submitBtn.disabled = false;
      submitText.classList.remove('hidden');
      submitLoading.classList.add('hidden');

      
    }

    function showMessage(text, type) {
      const msgEl = document.getElementById('success-message');
      msgEl.textContent = text;
      msgEl.classList.remove('hidden', 'bg-green-100', 'border-green-300', 'text-green-800', 'bg-red-100', 'border-red-300', 'text-red-800', 'bg-yellow-100', 'border-yellow-300', 'text-yellow-800');
      
      if (type === 'success') {
        msgEl.classList.add('bg-green-100', 'border-green-300', 'text-green-800');
      } else if (type === 'error') {
        msgEl.classList.add('bg-red-100', 'border-red-300', 'text-red-800');
      } else {
        msgEl.classList.add('bg-yellow-100', 'border-yellow-300', 'text-yellow-800');
      }

      setTimeout(() => msgEl.classList.add('hidden'), 3000);
    }

    function resetForm() {
      document.getElementById('amal-form').reset();
      calculatePoints();
    }

    function renderRecords() {
      const container = document.getElementById('records-list');

      // Filter berdasarkan user yang login
      let filteredRecords = allRecords;
      if (currentUser && currentUser.role === 'siswa') {
        filteredRecords = allRecords.filter(r => r.nama_siswa === `Siswa Ke-${currentUser.studentId}`);
      }

      const filtered = filteredRecords.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

      if (filtered.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-8">Tidak ada data amal yaumi.</p>';
        return;
      }

      container.innerHTML = filtered.map(record => {
        const sholatCount = [
          record.sholat_subuh, record.sholat_dzuhur, record.sholat_ashar,
          record.sholat_maghrib, record.sholat_isya
        ].filter(Boolean).length;

        const sunnahCount = [
          record.sholat_tarawih, record.sholat_witir, record.sholat_dhuha, record.sholat_tahajud, record.sholat_rawatib
        ].filter(Boolean).length;

        const date = new Date(record.tanggal);
        const dateStr = date.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

        return `
          <div class="p-4 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border border-emerald-100" data-id="${record.__backendId}">
            <div class="flex justify-between items-start mb-2">
              <div>
                <p class="font-bold text-emerald-800">${record.nama_siswa}</p>
                <p class="text-sm text-emerald-600">${record.kelas} â€¢ ${dateStr}</p>
              </div>
              <button onclick="confirmDelete('${record.__backendId}')" class="text-red-500 hover:text-red-700 text-sm px-2 py-1 rounded hover:bg-red-50 transition-colors">
                ğŸ—‘ï¸
              </button>
            </div>
            <div class="flex flex-wrap gap-2 text-xs mb-2">
              <span class="px-2 py-1 bg-emerald-200 text-emerald-800 rounded-full">ğŸ•Œ Wajib: ${sholatCount}/5</span>
              <span class="px-2 py-1 bg-purple-200 text-purple-800 rounded-full">âœ¨ Sunnah: ${sunnahCount}/5</span>
              ${record.puasa ? '<span class="px-2 py-1 bg-amber-200 text-amber-800 rounded-full">ğŸŒ™ Puasa</span>' : ''}
              ${record.tilawah_quran ? '<span class="px-2 py-1 bg-blue-200 text-blue-800 rounded-full">ğŸ“– Tilawah</span>' : ''}
              ${record.sedekah ? '<span class="px-2 py-1 bg-pink-200 text-pink-800 rounded-full">ğŸ’ Sedekah</span>' : ''}
            </div>
            <div class="p-2 bg-yellow-100 rounded text-center">
              <p class="text-xs text-yellow-800">Total Poin: <span class="font-bold text-lg">${record.total_poin || 0}</span></p>
            </div>
          </div>
        `;
      }).join('');
    }

    let pendingDelete = null;

    function confirmDelete(id) {
      const record = allRecords.find(r => r.__backendId === id);
      if (!record) return;

      const container = document.querySelector(`[data-id="${id}"]`);
      const deleteBtn = container.querySelector('button');
      
      if (pendingDelete === id) {
        performDelete(record);
        pendingDelete = null;
      } else {
        pendingDelete = id;
        deleteBtn.innerHTML = 'â“ Yakin?';
        deleteBtn.className = 'text-white bg-red-500 hover:bg-red-600 text-sm px-3 py-1 rounded transition-colors';
        
        setTimeout(() => {
          if (pendingDelete === id) {
            deleteBtn.innerHTML = 'ğŸ—‘ï¸';
            deleteBtn.className = 'text-red-500 hover:text-red-700 text-sm px-2 py-1 rounded hover:bg-red-50 transition-colors';
            pendingDelete = null;
          }
        }, 3000);
      }
    }

    async function performDelete(record) {
        showMessage('âŒ Fitur hapus tidak tersedia karena data disimpan di Google Sheet.', 'warning');
      }

    // Element SDK initialization
    async function onConfigChange(cfg) {
      config = { ...defaultConfig, ...cfg };
      
      document.getElementById('school-name').textContent = config.school_name || defaultConfig.school_name;
      document.getElementById('page-title').textContent = 'ğŸ“¿ ' + (config.page_title || defaultConfig.page_title);
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.background_color || defaultConfig.background_color,
            set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
          },
          {
            get: () => cfg.surface_color || defaultConfig.surface_color,
            set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
          },
          {
            get: () => cfg.text_color || defaultConfig.text_color,
            set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
          },
          {
            get: () => cfg.primary_action || defaultConfig.primary_action,
            set: (v) => { cfg.primary_action = v; window.elementSdk.setConfig({ primary_action: v }); }
          },
          {
            get: () => cfg.secondary_action || defaultConfig.secondary_action,
            set: (v) => { cfg.secondary_action = v; window.elementSdk.setConfig({ secondary_action: v }); }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ['school_name', cfg.school_name || defaultConfig.school_name],
        ['page_title', cfg.page_title || defaultConfig.page_title]
      ]);
    }

    // Initialize
    async function init() {
      

      // Initialize Element SDK
      if (window.elementSdk) {
        try {
          window.elementSdk.init({
            defaultConfig,
            onConfigChange,
            mapToCapabilities,
            mapToEditPanelValues
          });
        } catch (err) {
          console.error('Error initializing Element SDK:', err);
        }
      }

      // Form submit handler
      document.getElementById('amal-form').addEventListener('submit', handleSubmit);

      // Setup checkbox listeners
      setupCheckboxListeners();

      // Set default date to today
      const today = new Date().toISOString().split('T')[0];
      const dateInput = document.getElementById('tanggal');
      if (today >= '2026-02-18' && today <= '2026-03-18') {
        dateInput.value = today;
      }

      // Initialize points display
      calculatePoints();
    }

    // Wait for SDKs to be available before initializing
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
 </body>
</html>
